<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Data - Multiple Timeframes &#8212; backtrader 1.9.69.122 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxcontrib-images\LightBox2\lightbox2\css\lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mycss-2016-12-25-2300.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/sphinxcontrib-images\LightBox2\lightbox2\js\jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/sphinxcontrib-images\LightBox2\lightbox2\js\lightbox.min.js"></script>
    <script type="text/javascript" src="../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\jquery-noconflict.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="../_static/myjs-2016-12-25-2300.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data - Replay" href="../data-replay/data-replay.html" />
    <link rel="prev" title="Data Resampling" href="../data-resampling/data-resampling.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

 <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <!-- <a class="navbar-brand" href="../index.html"> -->
        <a class="navbar-brand" href="/">
          backtrader</a>
        <a href="../index.html">
	  <span class="navbar-text navbar-version pull-left"><b>1.9.69.122</b></span>
	</a>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav navbar-right"> 
            
                <li><a href="/">Home</a></li>
                <li><a href="/features">Features</a></li>
                <li><a href="/docu">Docs</a></li>
                <li><a href="/blog">Blog</a></li>
                <li><a href="https://community.backtrader.com">Community</a></li>
            
            
	      
              
            
            
            
            
            
          </ul>

          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <!-- backtrader-001 -->
      <ins class="adsbygoogle"
	   style="display:block"
	   data-ad-client="ca-pub-2694577446631179"
	   data-ad-slot="3977998265"
	   data-ad-format="auto"></ins>
      <script>
	(adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</div>
<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<div class="globaltoc">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Platform Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operating.html">Operating the platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cerebro.html">Cerebro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cerebro/cheat-on-open/cheat-on-open.html">Cheat On Open</a></li>
<li class="toctree-l1"><a class="reference internal" href="../strategy.html">Strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sizers/sizers.html">Sizers - Smart Staking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/timers.html">Timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order_target/order_target.html">Target Orders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../signal_strategy/signal_strategy.html">Strategy with Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../broker.html">Broker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slippage/slippage.html">Slippage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filler.html">Fillers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order.html">Orders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-creation-execution/order-creation-execution.html">Order Management and Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-creation-execution/oco/oco.html">OCO orders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-creation-execution/trail/stoptrail.html">StopTrail(Limit)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-creation-execution/bracket/bracket.html">Bracket Orders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../order-creation-execution/futurespot/future-vs-spot.html">Futures and Spot Compensation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datafeed.html">Data Feeds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datafeed-develop-csv.html">CSV Data Feed Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datafeed-develop-general/datafeed-develop-general.html">Binary Datafeed Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending-a-datafeed.html">Extending a Datafeed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pandas-datafeed/pandas-datafeed.html">Pandas DataFeed Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tradingcalendar/tradingcalendar.html">Trading Calendar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-resampling/data-resampling.html">Data Resampling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data - Multiple Timeframes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-1-daily-and-weekly">Example 1 - Daily and Weekly</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-2-daily-and-daily-compression-2-bars-to-1">Example 2 - Daily and Daily Compression (2 bars to 1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-3-strategy-with-sma">Example 3 - Strategy with SMA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#invocation-1">Invocation 1:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#invocation-2">Invocation 2:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data-replay/data-replay.html">Data - Replay</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-rollover/rolling-futures-over.html">Rolling over Futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../induse.html">Using Indicators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../talib/talib.html">TA-Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mixing-timeframes/indicators-mixing-timeframes.html">Mixing Timeframes in Indicators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inddev.html">Indicator Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../observers-and-statistics/observers-and-statistics.html">Observers and Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../observer-benchmark/benchmarking.html">Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzers/analyzers.html">Analyzers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzers/pyfolio.html">PyFolio Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzers/pyfolio-integration/pyfolio-integration.html">Pyfolio Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writer.html">Writer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commission-schemes/commission-schemes.html">Commissions: Stocks vs Futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending-commissions/commission-schemes-extended.html">Extending Commissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-defined-commissions/commission-schemes-subclassing.html">User Defined Commissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commission-credit.html">Commissions: Credit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../position.html">Position</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trade.html">Trade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting/plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting/ranges/plotting-date-ranges.html">Plotting Date Ranges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting/sameaxis/plot-sameaxis.html">Plotting on the same axis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimization-improvements.html">Optimization improvements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../automated-bt-run/automated-bt-run.html">Automating BackTesting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../memory-savings/memory-savings.html">Saving Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timemgmt.html">DateTime Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../live/live.html">Live Data Feeds and Live Trading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataautoref.html">Data Feeds Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datayahoo.html">Yahoo Data Feed Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../indautoref.html">Indicator Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../talibindautoref.html">TA-Lib Indicator Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../strategy-reference.html">Strategies Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzers-reference.html">Analyzers Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../observers-reference.html">Observers Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sizers-reference.html">Sizers Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters-reference.html">Filters Reference</a></li>
</ul>

</div>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="data-multiple-timeframes">
<h1>Data - Multiple Timeframes<a class="headerlink" href="#data-multiple-timeframes" title="Permalink to this headline">¶</a></h1>
<p>Sometimes investing decisions are taken using different timeframes:</p>
<blockquote>
<div><ul class="simple">
<li>Weekly to evaluate the trend</li>
<li>Daily to execute the entry</li>
</ul>
</div></blockquote>
<p>Or 5 minutes vs 60 minutes.</p>
<p>That implies that combining datas of multiple timeframes in <code class="docutils literal notranslate"><span class="pre">backtrader</span></code> is
needed to support such combinations.</p>
<p>Native support for it is already built-in. The end user must only follow these
rules:</p>
<blockquote>
<div><ul class="simple">
<li>The data with the smallest timeframe (and thus the larger number of bars)
must be the 1st one to be added to the Cerebro instance</li>
<li>The datas must be properly date-time aligned for the platform to make any
sense out of them</li>
</ul>
</div></blockquote>
<p>Beyond that, the end-user is free to apply indicators as wished on the
shorter/larger timeframes. Of course:</p>
<blockquote>
<div><ul class="simple">
<li>Indicators applied to larger timeframes will produce less bars</li>
</ul>
</div></blockquote>
<p>The platform will also have the following into account</p>
<blockquote>
<div><ul class="simple">
<li>The minimum period for larger timeframes</li>
</ul>
</div></blockquote>
<p>Minimum period which will probably have the side effect of having to consume
several orders of magnitude of the smaller timeframe bars before a Strategy
added to Cerebro kicks into action.</p>
<p>The built-in <code class="docutils literal notranslate"><span class="pre">cerebro.resample</span></code> is going to be used to create a larger timeframe.</p>
<p>Some examples below, but first the sauce of the test script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Load the Data</span>
    <span class="n">datapath</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">dataname</span> <span class="ow">or</span> <span class="s1">&#39;../../datas/2006-day-001.txt&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">btfeeds</span><span class="o">.</span><span class="n">BacktraderCSVData</span><span class="p">(</span><span class="n">dataname</span><span class="o">=</span><span class="n">datapath</span><span class="p">)</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">adddata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># First add the original data - smaller timeframe</span>

    <span class="n">tframes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">daily</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span> <span class="n">weekly</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Weeks</span><span class="p">,</span>
                   <span class="n">monthly</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Months</span><span class="p">)</span>

    <span class="c1"># Handy dictionary for the argument timeframe conversion</span>
    <span class="c1"># Resample the data</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">noresample</span><span class="p">:</span>
        <span class="n">datapath</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">dataname2</span> <span class="ow">or</span> <span class="s1">&#39;../../datas/2006-week-001.txt&#39;</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">btfeeds</span><span class="o">.</span><span class="n">BacktraderCSVData</span><span class="p">(</span><span class="n">dataname</span><span class="o">=</span><span class="n">datapath</span><span class="p">)</span>
        <span class="c1"># And then the large timeframe</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">adddata</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">resampledata</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">=</span><span class="n">tframes</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">timeframe</span><span class="p">],</span>
                             <span class="n">compression</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>

    <span class="c1"># Run over everything</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

</pre></div>
</div>
<p>The steps:</p>
<blockquote>
<div><ul>
<li><p class="first">Load a data</p>
</li>
<li><p class="first">Resample it according to the user specified arguments</p>
<p>The script also allows for loading a 2nd data</p>
</li>
<li><p class="first">Add the data to cerebro</p>
</li>
<li><p class="first">Add the resampled data (larger timeframe) to cerebro</p>
</li>
<li><p class="first">run</p>
</li>
</ul>
</div></blockquote>
<div class="section" id="example-1-daily-and-weekly">
<h2>Example 1 - Daily and Weekly<a class="headerlink" href="#example-1-daily-and-weekly" title="Permalink to this headline">¶</a></h2>
<p>The invocation of the script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./multitimeframe-example.py --timeframe weekly --compression 1
</pre></div>
</div>
<p>And the output chart:</p>
<a class=""
               data-lightbox="group-9d0f2588-36b0-450a-8566-29428f904d55"
               href="../_images/multitimeframe-daily-weekly1.png"
               title=""
               data-title=""
               ><img src="../_images/multitimeframe-daily-weekly1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="example-2-daily-and-daily-compression-2-bars-to-1">
<h2>Example 2 - Daily and Daily Compression (2 bars to 1)<a class="headerlink" href="#example-2-daily-and-daily-compression-2-bars-to-1" title="Permalink to this headline">¶</a></h2>
<p>The invocation of the script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./multitimeframe-example.py --timeframe daily --compression 2
</pre></div>
</div>
<p>And the output chart:</p>
<a class=""
               data-lightbox="group-61a5d178-f685-4858-b832-03fcd976a483"
               href="../_images/multitimeframe-daily-daily-21.png"
               title=""
               data-title=""
               ><img src="../_images/multitimeframe-daily-daily-21.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="example-3-strategy-with-sma">
<h2>Example 3 - Strategy with SMA<a class="headerlink" href="#example-3-strategy-with-sma" title="Permalink to this headline">¶</a></h2>
<p>Although plotting is nice, the key issue here is showing how the larger
timeframe influences the system, especially when it comes down to the starting
point</p>
<p>The script can take a <code class="docutils literal notranslate"><span class="pre">--indicators</span></code> to add a strategy which creates simple
moving averages of <strong>period 10</strong> on the smaller an larger timeframe datas.</p>
<p>If only the smaller timeframe was taken into account:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">next</span></code> would be called first after 10 bars, which is the time the Simple
Moving Average needs to produce a value</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember that Strategy monitors created indicators and only calls
<code class="docutils literal notranslate"><span class="pre">next</span></code> when all indicators have produced a value. The rationale is that
the end user has added the indicators to use them in the logic and thus
no logic should take place if the indicators have produced no values</p>
</div>
</li>
</ul>
</div></blockquote>
<p>But in this case the larger timeframe (weekly) delays the invocation of <code class="docutils literal notranslate"><span class="pre">next</span></code>
until the Simple Moving Average oon the weekly data has produced a value, which
takes … 10 weeks.</p>
<p>The script overrides <code class="docutils literal notranslate"><span class="pre">nextstart</span></code> which is only called once and which defaults
to calling <code class="docutils literal notranslate"><span class="pre">next</span></code> to show when it is first called.</p>
<div class="section" id="invocation-1">
<h3>Invocation 1:<a class="headerlink" href="#invocation-1" title="Permalink to this headline">¶</a></h3>
<p>Only the smaller timeframe, daily, gets a Simple Moving Average</p>
<p>The command line and output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./multitimeframe-example.py --timeframe weekly --compression 1 --indicators --onlydaily
--------------------------------------------------
nextstart called with len 10
--------------------------------------------------
</pre></div>
</div>
<p>And the chart.</p>
<a class=""
               data-lightbox="group-610da2d8-7248-4327-9690-8871ec508837"
               href="../_images/multitimeframe-daily-weekly-indicators-onlydaily1.png"
               title=""
               data-title=""
               ><img src="../_images/multitimeframe-daily-weekly-indicators-onlydaily1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="invocation-2">
<h3>Invocation 2:<a class="headerlink" href="#invocation-2" title="Permalink to this headline">¶</a></h3>
<p>Both timeframes get a Simple Moving Average</p>
<p>The command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./multitimeframe-example.py --timeframe weekly --compression 1 --indicators
--------------------------------------------------
nextstart called with len 50
--------------------------------------------------
--------------------------------------------------
nextstart called with len 51
--------------------------------------------------
--------------------------------------------------
nextstart called with len 52
--------------------------------------------------
--------------------------------------------------
nextstart called with len 53
--------------------------------------------------
--------------------------------------------------
nextstart called with len 54
--------------------------------------------------
</pre></div>
</div>
<p>Two things to notice here:</p>
<blockquote>
<div><ul>
<li><p class="first">Instead of being called after <strong>10</strong> periods, the strategy is 1st called
after 50 periods.</p>
<p>It is so because the Simple Moving Average applied on the larger (weekly)
timeframe produces a value after 10 weeks … and that is 10 weeks * 5 days
/ week … 50 days</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">nextstart</span></code> gets called 5 times rather than only 1.</p>
<p>This is a natural side effect of having mixed the timeframe and having (in
this case only one) indicators applied to the larger timeframe.</p>
<p>The larger timeframe Simple Moving Average produces 5 times the same value
whilst 5 daily bars are being consumed.</p>
<p>And because the start of the period is being controlled by the larger
timeframe <code class="docutils literal notranslate"><span class="pre">nextstart</span></code> gets called 5 times.</p>
</li>
</ul>
</div></blockquote>
<p>And the chart.</p>
<a class=""
               data-lightbox="group-0ed364a4-8215-4491-9cb4-fa86e6d4a580"
               href="../_images/multitimeframe-daily-weekly-indicators1.png"
               title=""
               data-title=""
               ><img src="../_images/multitimeframe-daily-weekly-indicators1.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Multiple Timeframe Datas can be used in <code class="docutils literal notranslate"><span class="pre">backtrader</span></code> with no special objects
or tweaking: just add the smaller timeframes first.</p>
<p>The test script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">argparse</span>

<span class="kn">import</span> <span class="nn">backtrader</span> <span class="kn">as</span> <span class="nn">bt</span>
<span class="kn">import</span> <span class="nn">backtrader.feeds</span> <span class="kn">as</span> <span class="nn">btfeeds</span>
<span class="kn">import</span> <span class="nn">backtrader.indicators</span> <span class="kn">as</span> <span class="nn">btind</span>


<span class="k">class</span> <span class="nc">SMAStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;onlydaily&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sma_small_tf</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">onlydaily</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sma_large_tf</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nextstart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------------------------------------------------&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;nextstart called with len&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------------------------------------------------&#39;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">SMAStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">nextstart</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">runstrat</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Create a cerebro entity</span>
    <span class="n">cerebro</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Cerebro</span><span class="p">(</span><span class="n">stdstats</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="c1"># Add a strategy</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">indicators</span><span class="p">:</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">addstrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">addstrategy</span><span class="p">(</span>
            <span class="n">SMAStrategy</span><span class="p">,</span>

            <span class="c1"># args for the strategy</span>
            <span class="n">period</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">period</span><span class="p">,</span>
            <span class="n">onlydaily</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">onlydaily</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Load the Data</span>
    <span class="n">datapath</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">dataname</span> <span class="ow">or</span> <span class="s1">&#39;../../datas/2006-day-001.txt&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">btfeeds</span><span class="o">.</span><span class="n">BacktraderCSVData</span><span class="p">(</span><span class="n">dataname</span><span class="o">=</span><span class="n">datapath</span><span class="p">)</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">adddata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># First add the original data - smaller timeframe</span>

    <span class="n">tframes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">daily</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Days</span><span class="p">,</span> <span class="n">weekly</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Weeks</span><span class="p">,</span>
                   <span class="n">monthly</span><span class="o">=</span><span class="n">bt</span><span class="o">.</span><span class="n">TimeFrame</span><span class="o">.</span><span class="n">Months</span><span class="p">)</span>

    <span class="c1"># Handy dictionary for the argument timeframe conversion</span>
    <span class="c1"># Resample the data</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">noresample</span><span class="p">:</span>
        <span class="n">datapath</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">dataname2</span> <span class="ow">or</span> <span class="s1">&#39;../../datas/2006-week-001.txt&#39;</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">btfeeds</span><span class="o">.</span><span class="n">BacktraderCSVData</span><span class="p">(</span><span class="n">dataname</span><span class="o">=</span><span class="n">datapath</span><span class="p">)</span>
        <span class="c1"># And then the large timeframe</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">adddata</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cerebro</span><span class="o">.</span><span class="n">resampledata</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">=</span><span class="n">tframes</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">timeframe</span><span class="p">],</span>
                             <span class="n">compression</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>

    <span class="c1"># Run over everything</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Plot the result</span>
    <span class="n">cerebro</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Multitimeframe test&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--dataname&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;File Data to Load&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--dataname2&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Larger timeframe file to load&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--noresample&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Do not resample, rather load larger timeframe&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--timeframe&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;weekly&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="s1">&#39;weekly&#39;</span><span class="p">,</span> <span class="s1">&#39;monhtly&#39;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Timeframe to resample to&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--compression&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Compress n bars into 1&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--indicators&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Wether to apply Strategy with indicators&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--onlydaily&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Indicator only to be applied to daily timeframe&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--period&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Period to apply to indicator&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">runstrat</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, 2016, 2017, 2018 Daniel Rodriguez.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>