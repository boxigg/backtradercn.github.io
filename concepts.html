<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Platform Concepts &#8212; backtrader 1.9.69.122 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxcontrib-images\LightBox2\lightbox2\css\lightbox.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-3.3.6/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/mycss-2016-12-25-2300.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images\LightBox2\lightbox2\js\jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images\LightBox2\lightbox2\js\lightbox.min.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images\LightBox2\lightbox2-customize\jquery-noconflict.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="_static/myjs-2016-12-25-2300.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Operating the platform" href="operating.html" />
    <link rel="prev" title="Quickstart" href="quickstart/quickstart.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

 <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <!-- <a class="navbar-brand" href="index.html"> -->
        <a class="navbar-brand" href="/">
          backtrader</a>
        <a href="index.html">
	  <span class="navbar-text navbar-version pull-left"><b>1.9.69.122</b></span>
	</a>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav navbar-right"> 
            
                <li><a href="/">Home</a></li>
                <li><a href="/features">Features</a></li>
                <li><a href="/docu">Docs</a></li>
                <li><a href="/blog">Blog</a></li>
                <li><a href="https://community.backtrader.com">Community</a></li>
            
            
	      
              
            
            
            
            
            
          </ul>

          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <!-- backtrader-001 -->
      <ins class="adsbygoogle"
	   style="display:block"
	   data-ad-client="ca-pub-2694577446631179"
	   data-ad-slot="3977998265"
	   data-ad-format="auto"></ins>
      <script>
	(adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</div>
<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<div class="globaltoc">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart/quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Platform Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#before-starting">Before Starting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-feeds-passing-them-around">Data Feeds - Passing them around</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#shortcuts-for-data-feeds">Shortcuts for Data Feeds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#omitting-the-data-feeds">Omitting the Data Feeds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#almost-everything-is-a-data-feed">Almost everything is a <em>Data Feed</em></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lines">Lines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lines-declaration"><em>Lines</em> declaration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-lines-in-data-feeds">Accessing <code class="docutils literal notranslate"><span class="pre">lines</span></code> in <em>Data Feeds</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#lines-len"><em>Lines</em> len</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inheritance-of-lines-and-params">Inheritance of Lines and Params</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#indexing-0-and-1">Indexing: 0 and -1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#slicing">Slicing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-a-slice">Getting a slice</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lines-delayed-indexing">Lines: DELAYED indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lines-coupling">Lines Coupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#operators-using-natural-constructs">Operators, using natural constructs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#stage-1-operators-create-objects">Stage 1 - Operators Create Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stage-2-operators-true-to-nature">Stage 2 - Operators true to nature</a></li>
<li class="toctree-l3"><a class="reference internal" href="#some-non-overriden-operators-functions">Some non-overriden operators/functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="operating.html">Operating the platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="cerebro.html">Cerebro</a></li>
<li class="toctree-l1"><a class="reference internal" href="cerebro/cheat-on-open/cheat-on-open.html">Cheat On Open</a></li>
<li class="toctree-l1"><a class="reference internal" href="strategy.html">Strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="sizers/sizers.html">Sizers - Smart Staking</a></li>
<li class="toctree-l1"><a class="reference internal" href="timers/timers.html">Timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="order_target/order_target.html">Target Orders</a></li>
<li class="toctree-l1"><a class="reference internal" href="signal_strategy/signal_strategy.html">Strategy with Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="broker.html">Broker</a></li>
<li class="toctree-l1"><a class="reference internal" href="slippage/slippage.html">Slippage</a></li>
<li class="toctree-l1"><a class="reference internal" href="filler.html">Fillers</a></li>
<li class="toctree-l1"><a class="reference internal" href="order.html">Orders</a></li>
<li class="toctree-l1"><a class="reference internal" href="order-creation-execution/order-creation-execution.html">Order Management and Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="order-creation-execution/oco/oco.html">OCO orders</a></li>
<li class="toctree-l1"><a class="reference internal" href="order-creation-execution/trail/stoptrail.html">StopTrail(Limit)</a></li>
<li class="toctree-l1"><a class="reference internal" href="order-creation-execution/bracket/bracket.html">Bracket Orders</a></li>
<li class="toctree-l1"><a class="reference internal" href="order-creation-execution/futurespot/future-vs-spot.html">Futures and Spot Compensation</a></li>
<li class="toctree-l1"><a class="reference internal" href="datafeed.html">Data Feeds</a></li>
<li class="toctree-l1"><a class="reference internal" href="datafeed-develop-csv.html">CSV Data Feed Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="datafeed-develop-general/datafeed-develop-general.html">Binary Datafeed Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending-a-datafeed.html">Extending a Datafeed</a></li>
<li class="toctree-l1"><a class="reference internal" href="pandas-datafeed/pandas-datafeed.html">Pandas DataFeed Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="tradingcalendar/tradingcalendar.html">Trading Calendar</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-resampling/data-resampling.html">Data Resampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-multitimeframe/data-multitimeframe.html">Data - Multiple Timeframes</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-replay/data-replay.html">Data - Replay</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-rollover/rolling-futures-over.html">Rolling over Futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="induse.html">Using Indicators</a></li>
<li class="toctree-l1"><a class="reference internal" href="talib/talib.html">TA-Lib</a></li>
<li class="toctree-l1"><a class="reference internal" href="mixing-timeframes/indicators-mixing-timeframes.html">Mixing Timeframes in Indicators</a></li>
<li class="toctree-l1"><a class="reference internal" href="inddev.html">Indicator Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="observers-and-statistics/observers-and-statistics.html">Observers and Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="observer-benchmark/benchmarking.html">Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzers/analyzers.html">Analyzers</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzers/pyfolio.html">PyFolio Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzers/pyfolio-integration/pyfolio-integration.html">Pyfolio Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="writer.html">Writer</a></li>
<li class="toctree-l1"><a class="reference internal" href="commission-schemes/commission-schemes.html">Commissions: Stocks vs Futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending-commissions/commission-schemes-extended.html">Extending Commissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-defined-commissions/commission-schemes-subclassing.html">User Defined Commissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="commission-credit.html">Commissions: Credit</a></li>
<li class="toctree-l1"><a class="reference internal" href="position.html">Position</a></li>
<li class="toctree-l1"><a class="reference internal" href="trade.html">Trade</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting/plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting/ranges/plotting-date-ranges.html">Plotting Date Ranges</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting/sameaxis/plot-sameaxis.html">Plotting on the same axis</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization-improvements.html">Optimization improvements</a></li>
<li class="toctree-l1"><a class="reference internal" href="automated-bt-run/automated-bt-run.html">Automating BackTesting</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory-savings/memory-savings.html">Saving Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="timemgmt.html">DateTime Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="live/live.html">Live Data Feeds and Live Trading</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataautoref.html">Data Feeds Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="datayahoo.html">Yahoo Data Feed Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="indautoref.html">Indicator Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="talibindautoref.html">TA-Lib Indicator Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="strategy-reference.html">Strategies Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzers-reference.html">Analyzers Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="observers-reference.html">Observers Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="sizers-reference.html">Sizers Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters-reference.html">Filters Reference</a></li>
</ul>

</div>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="platform-concepts">
<h1>Platform Concepts<a class="headerlink" href="#platform-concepts" title="Permalink to this headline">¶</a></h1>
<p>This is a collection of some of the concepts of the platform. It tries to gather
information bits which can be useful in using the platform.</p>
<div class="section" id="before-starting">
<h2>Before Starting<a class="headerlink" href="#before-starting" title="Permalink to this headline">¶</a></h2>
<p>All mini-code examples assume the following imports are available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">backtrader</span> <span class="k">as</span> <span class="nn">bt</span>
<span class="kn">import</span> <span class="nn">backtrader.indicators</span> <span class="k">as</span> <span class="nn">btind</span>
<span class="kn">import</span> <span class="nn">backtrader.feeds</span> <span class="k">as</span> <span class="nn">btfeeds</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>An alternative syntax for accessing sub-modules like <em>indicators</em> and <em>feeds</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">backtrader</span> <span class="k">as</span> <span class="nn">bt</span>
</pre></div>
</div>
<p>And then:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">thefeed</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">feeds</span><span class="o">.</span><span class="n">OneOfTheFeeds</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">theind</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">indicators</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-feeds-passing-them-around">
<h2>Data Feeds - Passing them around<a class="headerlink" href="#data-feeds-passing-them-around" title="Permalink to this headline">¶</a></h2>
<p>The basis of the work with the platform will be done with <em>Strategies</em>. And
these will get passed <em>Data Feeds</em>. The platform end user does not need to care
about receiving them:</p>
<blockquote>
<div><em>Data Feeds are automagically provided member variables to the strategy in the
form of an array and shortcuts to the array positions</em></div></blockquote>
<p>Quick preview of a Strategy derived class declaration and running the platform:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sma</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>

    <span class="o">...</span>

<span class="n">cerebro</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Cerebro</span><span class="p">()</span>

<span class="o">...</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">btfeeds</span><span class="o">.</span><span class="n">MyFeed</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">cerebro</span><span class="o">.</span><span class="n">adddata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="o">...</span>

<span class="n">cerebro</span><span class="o">.</span><span class="n">addstrategy</span><span class="p">(</span><span class="n">MyStrategy</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="o">...</span>
</pre></div>
</div>
<p>Notice the following:</p>
<blockquote>
<div><ul class="simple">
<li>No <code class="docutils literal notranslate"><span class="pre">*args</span></code> or <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> are being received by the strategy’s
<code class="docutils literal notranslate"><span class="pre">__init__</span></code> method (they may still be used)</li>
<li>A member variable <code class="docutils literal notranslate"><span class="pre">self.datas</span></code> exists which is array/list/iterable holding
at least one item (hopefully or else an exception will be raised)</li>
</ul>
</div></blockquote>
<p>So it is. <em>Data Feeds</em> get added to the platform and they will show up inside
the strategy in the sequential order in which they were added to the system.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This also applies to <code class="docutils literal notranslate"><span class="pre">Indicators</span></code>, should the end user develop his
own custom Indicator or when having a look at the source code for
some of the existing <a class="reference internal" href="indautoref.html#indautoref"><span class="std std-ref">Indicator Reference</span></a></p>
</div>
<div class="section" id="shortcuts-for-data-feeds">
<h3>Shortcuts for Data Feeds<a class="headerlink" href="#shortcuts-for-data-feeds" title="Permalink to this headline">¶</a></h3>
<p>The <cite>self.datas</cite> array items can be directly accessed with additional automatic
member variables:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">self.data</span></code> targets <code class="docutils literal notranslate"><span class="pre">self.datas[0]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">self.dataX</span></code> targets <code class="docutils literal notranslate"><span class="pre">self.datas[X]</span></code></li>
</ul>
</div></blockquote>
<p>The example then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sma</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>

    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="omitting-the-data-feeds">
<h3>Omitting the Data Feeds<a class="headerlink" href="#omitting-the-data-feeds" title="Permalink to this headline">¶</a></h3>
<p>The example above can be further simplified to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sma</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>

    <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">self.data</span></code> has been completely removed from the invocation of
<code class="docutils literal notranslate"><span class="pre">SimpleMovingAverage</span></code>. If this is done, the indicator (in this case the
<code class="docutils literal notranslate"><span class="pre">SimpleMovingAverage</span></code>) receives the first data of the object in which is
being created (the <em>Strategy</em>), which is <code class="docutils literal notranslate"><span class="pre">self.data</span></code> (aka <code class="docutils literal notranslate"><span class="pre">self.data0</span></code> or
<code class="docutils literal notranslate"><span class="pre">self.datas[0]</span></code>)</p>
</div>
<div class="section" id="almost-everything-is-a-data-feed">
<h3>Almost everything is a <em>Data Feed</em><a class="headerlink" href="#almost-everything-is-a-data-feed" title="Permalink to this headline">¶</a></h3>
<p>Not only <cite>Data Feeds</cite> are data and can be passed around. <code class="docutils literal notranslate"><span class="pre">Indicators</span></code> and
results of <code class="docutils literal notranslate"><span class="pre">Operations</span></code> are also data.</p>
<p>In the previous example the <code class="docutils literal notranslate"><span class="pre">SimpleMovingAverage</span></code> was receiving
<code class="docutils literal notranslate"><span class="pre">self.datas[0]</span></code> as input to operate on. An example with operations and extra
indicators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">period1</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">period2</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">period3</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">period4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sma1</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period1</span><span class="p">)</span>

        <span class="c1"># This 2nd Moving Average operates using sma1 as &quot;data&quot;</span>
        <span class="n">sma2</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="n">sma1</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period2</span><span class="p">)</span>

        <span class="c1"># New data created via arithmetic operation</span>
        <span class="n">something</span> <span class="o">=</span> <span class="n">sma2</span> <span class="o">-</span> <span class="n">sma1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span>

        <span class="c1"># This 3rd Moving Average operates using something  as &quot;data&quot;</span>
        <span class="n">sma3</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="n">something</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period3</span><span class="p">)</span>

        <span class="c1"># Comparison operators work too ...</span>
        <span class="n">greater</span> <span class="o">=</span> <span class="n">sma3</span> <span class="o">&gt;</span> <span class="n">sma</span>

        <span class="c1"># Pointless Moving Average of True/False values but valid</span>
        <span class="c1"># This 4th Moving Average operates using greater  as &quot;data&quot;</span>
        <span class="n">sma3</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="n">greater</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period4</span><span class="p">)</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>Basically everything gets transformed into an object which can be used as a
data feed once it has been operated upon.</p>
</div>
</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<p>Mostly every other <code class="docutils literal notranslate"><span class="pre">class</span></code> in the platform supports the notion of
<em>parameters</em>.</p>
<blockquote>
<div><ul class="simple">
<li>Parameters along with default values are declared as a class attribute
(tuple of tuples or dict-like object)</li>
<li>Keywords args (<code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>) are scanned for matching parameters, removing
them from <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> if found and assigning the value to the corresponding
parameter</li>
<li>And parameters can be finally used in instances of the class by accessing
the member variable <code class="docutils literal notranslate"><span class="pre">self.params</span></code> (shorthand: <code class="docutils literal notranslate"><span class="pre">self.p</span></code>)</li>
</ul>
</div></blockquote>
<p>The previous quick Strategy preview already contains a parameters example, but
for the sake of redundancy, again, focusing only on the parameters. Using <em>tuples</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sma</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
</pre></div>
</div>
<p>And using a <code class="docutils literal notranslate"><span class="pre">dict</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sma</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="lines">
<h2>Lines<a class="headerlink" href="#lines" title="Permalink to this headline">¶</a></h2>
<p>Again mostly every other object in the platform is a <code class="docutils literal notranslate"><span class="pre">Lines</span></code> enabled
object. From a end user point of view this means:</p>
<blockquote>
<div><ul class="simple">
<li>It can hold one of more line series, being a line series an array of values
were the values put together in a chart they would form a line.</li>
</ul>
</div></blockquote>
<p>A good example of a <em>line</em> (or <em>lineseries</em>) is the line formed by the closing
prices of a stock. This is actually a well-known chart representation of the
evolution of prices (known as <em>Line on Close</em>)</p>
<p>Regular use of the platform is only concerned with <strong>accessing</strong> <code class="docutils literal notranslate"><span class="pre">lines</span></code>. The
previous mini-strategy example, lightly extended, comes in handy again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">movav</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">movav</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">sma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simple Moving Average is greater than the closing price&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Two objects with <code class="docutils literal notranslate"><span class="pre">lines</span></code> have been exposed:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">self.data</span></code>
It has a <code class="docutils literal notranslate"><span class="pre">lines</span></code> attribute which contains a <code class="docutils literal notranslate"><span class="pre">close</span></code> attribute in turn</li>
<li><code class="docutils literal notranslate"><span class="pre">self.movav</span></code> which is a <code class="docutils literal notranslate"><span class="pre">SimpleMovingAverage</span></code> indicator
It has a <code class="docutils literal notranslate"><span class="pre">lines</span></code> attribute which contains a <code class="docutils literal notranslate"><span class="pre">sma</span></code> attribute in turn</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It should be obvious from this, that <code class="docutils literal notranslate"><span class="pre">lines</span></code> are named. They can
also be accessed sequentially following the declaration order, but
this should only be used in <code class="docutils literal notranslate"><span class="pre">Indicator</span></code> development</p>
</div>
<p>And both <em>lines</em>, namely <code class="docutils literal notranslate"><span class="pre">close</span></code> and <code class="docutils literal notranslate"><span class="pre">sma</span></code> can be queried for a point
(<em>index 0</em>) to compare the values.</p>
<p>Shorthand access to lines do exist:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">xxx.lines</span></code> can be shortened to <code class="docutils literal notranslate"><span class="pre">xxx.l</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">xxx.lines.name</span></code> can be shortened to <code class="docutils literal notranslate"><span class="pre">xxx.lines_name</span></code></li>
<li>Complex objects like Strategies and Indicators offer quick access to data’s
lines<ul>
<li><code class="docutils literal notranslate"><span class="pre">self.data_name</span></code> offers a direct access to <code class="docutils literal notranslate"><span class="pre">self.data.lines.name</span></code></li>
<li>Which also applies to the numbered data variables: <code class="docutils literal notranslate"><span class="pre">self.data1_name</span></code> -&gt;
<code class="docutils literal notranslate"><span class="pre">self.data1.lines.name</span></code></li>
</ul>
</li>
</ul>
</div></blockquote>
<p>Additionally the line names are directly accessible with:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">self.data.close</span></code> and <code class="docutils literal notranslate"><span class="pre">self.movav.sma</span></code></p>
<p>But the notation doesn’t make as clear as the previous one if <em>lines</em> are
actually being accessed.</p>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Setting</strong>/<strong>Assigning</strong> the lines with these two later notations is
not supported</p>
</div>
<div class="section" id="lines-declaration">
<h3><em>Lines</em> declaration<a class="headerlink" href="#lines-declaration" title="Permalink to this headline">¶</a></h3>
<p>If an <em>Indicator</em> is being developed, the <em>lines</em> which the indicator has must
be declared.</p>
<p>Just as with <em>params</em> this takes place as a class attribute this time <em>ONLY</em> as
a tuple. Dictionaries are not supported because they do not store things
following insertion order.</p>
<p>For the Simple Moving Average it would be done like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleMovingAverage</span><span class="p">(</span><span class="n">Indicator</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;sma&#39;</span><span class="p">,)</span>

    <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <em>comma</em> following the declaration is needed in tuples if you pass
a single string to the tuple or else each letter in the string would be
interpreted as an item to be added to the tuple. Possibly one of the
few spots where Python’s syntax got it wrong.</p>
</div>
<p>As seen in the previous example this declaration creates a <code class="docutils literal notranslate"><span class="pre">sma</span></code> line in the
<em>Indicator</em> that can be later accessed in the Strategy’s logic (and possibly by
other indicators to create more complex indicators)</p>
<p>For development is sometimes useful to access the lines in a generic non-named
manner and this is where numbered access comes in handy:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">self.lines[0]</span></code> points to <code class="docutils literal notranslate"><span class="pre">self.lines.sma</span></code></li>
</ul>
</div></blockquote>
<p>Had more lines been defined they would be accessed with index 1, 2, and higher.</p>
<p>And of course, extra shorthand versions do exist:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">self.line</span></code> points to <code class="docutils literal notranslate"><span class="pre">self.lines[0]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">self.lineX</span></code> point to <code class="docutils literal notranslate"><span class="pre">self.lines[X]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">self.line_X</span></code> point to <code class="docutils literal notranslate"><span class="pre">self.lines[X]</span></code></li>
</ul>
</div></blockquote>
<p>Inside objects which are receiving <em>datas feeds</em> the lines below these data
feeds can also be quickly accessed by number:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">self.dataY</span></code> points to <code class="docutils literal notranslate"><span class="pre">self.data.lines[Y]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">self.dataX_Y</span></code> points to <code class="docutils literal notranslate"><span class="pre">self.dataX.lines[X]</span></code> which is a full shorthard
version of <code class="docutils literal notranslate"><span class="pre">self.datas[X].lines[Y]</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="accessing-lines-in-data-feeds">
<h3>Accessing <code class="docutils literal notranslate"><span class="pre">lines</span></code> in <em>Data Feeds</em><a class="headerlink" href="#accessing-lines-in-data-feeds" title="Permalink to this headline">¶</a></h3>
<p>Inside <em>data feeds</em> the <code class="docutils literal notranslate"><span class="pre">lines</span></code> can also be accessed omitting the
<code class="docutils literal notranslate"><span class="pre">lines</span></code>. This makes it more natural to work with thinks like <code class="docutils literal notranslate"><span class="pre">close</span></code>
prices.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">btfeeds</span><span class="o">.</span><span class="n">BacktraderCSVData</span><span class="p">(</span><span class="n">dataname</span><span class="o">=</span><span class="s1">&#39;mydata.csv&#39;</span><span class="p">)</span>

<span class="o">...</span>

<span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">30.0</span><span class="p">:</span>
            <span class="o">...</span>
</pre></div>
</div>
<p>Which seems more natural than the also valid: <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">self.data.lines.close[0]</span> <span class="pre">&gt;</span>
<span class="pre">30.0:</span></code>. The same doesn’t apply to <code class="docutils literal notranslate"><span class="pre">Indicators</span></code> with the reasoning being:</p>
<blockquote>
<div><ul class="simple">
<li>An <code class="docutils literal notranslate"><span class="pre">Indicator</span></code> could have an attribute <code class="docutils literal notranslate"><span class="pre">close</span></code> which holds an
intermediate calculation, which is later delivered to the actual <code class="docutils literal notranslate"><span class="pre">lines</span></code>
also named <code class="docutils literal notranslate"><span class="pre">close</span></code></li>
</ul>
</div></blockquote>
<p>In the case of <em>Data Feeds</em>, no calculation takes place, because it is only a
data source.</p>
</div>
<div class="section" id="lines-len">
<h3><em>Lines</em> len<a class="headerlink" href="#lines-len" title="Permalink to this headline">¶</a></h3>
<p><em>Lines</em> have a set of points and grow dynamically during execution, therefore
the length can be measured at any time by invoking the standard Python <code class="docutils literal notranslate"><span class="pre">len</span></code>
function.</p>
<p>This applies to for example:</p>
<blockquote>
<div><ul class="simple">
<li>Data Feeds</li>
<li>Strategies</li>
<li>Indicators</li>
</ul>
</div></blockquote>
<p>An additional property applies to <em>Data Feeds</em> when the data is <strong>preloaded</strong>:</p>
<blockquote>
<div><ul class="simple">
<li>Method <code class="docutils literal notranslate"><span class="pre">buflen</span></code></li>
</ul>
</div></blockquote>
<p>The method returns the actual number of bars the <em>Data Feed</em> has available.</p>
<p>The difference between <code class="docutils literal notranslate"><span class="pre">len</span></code> and <code class="docutils literal notranslate"><span class="pre">buflen</span></code></p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">len</span></code> reports how many bars have been processed</li>
<li><code class="docutils literal notranslate"><span class="pre">buflen</span></code> reports the total number of bars which have been loaded for the
Data Feed</li>
</ul>
</div></blockquote>
<p>If both return the same value, either no data has been preloaded or the
processing of bars has consumed all preloaded bars (and unless the system is
connected to a live feed, this will mean the end of processing)</p>
</div>
<div class="section" id="inheritance-of-lines-and-params">
<h3>Inheritance of Lines and Params<a class="headerlink" href="#inheritance-of-lines-and-params" title="Permalink to this headline">¶</a></h3>
<p>A kind of metalanguage is in place to support declaration of <em>Params</em> and
<em>Lines</em>. Every effort has been made to make it compatible with standard Python
inheritance rules.</p>
<div class="section" id="params-inheritance">
<h4>Params inheritance<a class="headerlink" href="#params-inheritance" title="Permalink to this headline">¶</a></h4>
<p>Inheritance should work as expected:</p>
<blockquote>
<div><ul class="simple">
<li>Multiple inheritance is supported</li>
<li>Params from base classes are inherited</li>
<li>If multiple base classes define the same param the default value of the last
class in the inheritance list is used</li>
<li>If the same param is redefined in a child class, the new default value takes
over that of the base class</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="lines-inheritance">
<h4>Lines Inheritance<a class="headerlink" href="#lines-inheritance" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>Multiple inheritance is supported</li>
<li>Lines from all base classes are inherited. Being <em>named</em> lines there will
only be one version of a line if the same name has been used more than once
in base classes</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="indexing-0-and-1">
<h2>Indexing: 0 and -1<a class="headerlink" href="#indexing-0-and-1" title="Permalink to this headline">¶</a></h2>
<p><em>Lines</em> as seen before are line series and have a set of points that conform a
line when drawn together (like when joining all closing prices together along a
time axis)</p>
<p>To access those points in regular code, the choice has been to use a <strong>0</strong> based
approach for the current <em>get/set</em> instant.</p>
<p>Strategies do only <em>get</em> values. Indicators do also <em>set</em> values.</p>
<p>From the previous quick strategy example where the <code class="docutils literal notranslate"><span class="pre">next</span></code> method was briefly seen:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">movav</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">sma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simple Moving Average is greater than the closing price&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The logic is <em>getting</em> the current value of the moving average and the current
closing price by applying index <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Actually for index <code class="docutils literal notranslate"><span class="pre">0</span></code> and when applying logic/arithmetic operators
the comparison can be made directly as in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">movav</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">sma</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">close</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p class="last">See later in the document the explanation for operators.</p>
</div>
<p>Setting is meant to be used when developing, for example, an <cite>Indicator</cite>,
because the current output value has to be <cite>set</cite> by the indicator.</p>
<p>A SimpleMovingAverage can be calculated for the current <cite>get/set</cite> point as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period</span>
</pre></div>
</div>
<p>Accessing previous <cite>set</cite> points has been modeled following the definition Python
makes for <code class="docutils literal notranslate"><span class="pre">-1</span></code> when accessing an array/iterable</p>
<blockquote>
<div><ul class="simple">
<li>It points to the last item of the array</li>
</ul>
</div></blockquote>
<p>The platform consider the last <cite>set</cite> item (before the current live <cite>get/set</cite>
point) to be <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</p>
<p>As such comparing the current <code class="docutils literal notranslate"><span class="pre">close</span></code> to the <em>previous</em> <code class="docutils literal notranslate"><span class="pre">close</span></code> is a <code class="docutils literal notranslate"><span class="pre">0</span></code>
vs <code class="docutils literal notranslate"><span class="pre">-1</span></code> thing. In a strategy, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Closing price is higher today&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Of course and logically, prices <em>set</em> before <code class="docutils literal notranslate"><span class="pre">-1</span></code> will be accessed with <code class="docutils literal notranslate"><span class="pre">-2,</span>
<span class="pre">-3,</span> <span class="pre">...</span></code>.</p>
</div>
<div class="section" id="slicing">
<h2>Slicing<a class="headerlink" href="#slicing" title="Permalink to this headline">¶</a></h2>
<p><em>backtrader</em> doesn’t support slicing for <em>lines</em> objects and this is a design
decision following the <code class="docutils literal notranslate"><span class="pre">[0]</span></code> and <code class="docutils literal notranslate"><span class="pre">[-1]</span></code> indexing scheme. With regular
indexable Python objects you would do things like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_sma</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span>  <span class="c1"># slice from the beginning til the end</span>
</pre></div>
</div>
<p>But remember that with the choice for <code class="docutils literal notranslate"><span class="pre">0</span></code> … it is actually the currently
delivered value, there is nothing after it. Also:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_sma</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># slice from the beginning til the end</span>
</pre></div>
</div>
<p>Again … <code class="docutils literal notranslate"><span class="pre">0</span></code> is the current value and <code class="docutils literal notranslate"><span class="pre">-1</span></code> is the latest (previous)
delivered value. That’s why a slice from <code class="docutils literal notranslate"><span class="pre">0</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">-1</span></code> makes no sense in the
<em>backtrader</em> ecosystem.</p>
<p>If slicing were ever to be supported, it would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_sma</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># slice from current point backwards to the beginning</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_sma</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># last value and current value</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_sma</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># from last value backwards to the 3rd last value</span>
</pre></div>
</div>
<div class="section" id="getting-a-slice">
<h3>Getting a slice<a class="headerlink" href="#getting-a-slice" title="Permalink to this headline">¶</a></h3>
<p>An array with the latest values can still be gotten. The syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_sma</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ago</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># default values shown</span>
</pre></div>
</div>
<p>That would have returned an arry with <code class="docutils literal notranslate"><span class="pre">1</span></code> value (<code class="docutils literal notranslate"><span class="pre">size=1</span></code>) with the current
moment <code class="docutils literal notranslate"><span class="pre">0</span></code> as the staring point to look backwards.</p>
<p>To get 10 values from the current point in time (i.e.: the last 10 values):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_sma</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># ago defaults to 0</span>
</pre></div>
</div>
<p>Of course the array has the ordering you would expect. The leftmost value is
the oldest one and the rightmost value is the most current (it is a regular
python array and not a <em>lines</em> object)</p>
<p>To get the last 10 values skipping only the current point:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_sma</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ago</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lines-delayed-indexing">
<h2>Lines: DELAYED indexing<a class="headerlink" href="#lines-delayed-indexing" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">[]</span></code> operator syntax is there to extract individual values during the
<code class="docutils literal notranslate"><span class="pre">next</span></code> logic phase. <em>Lines</em> objects support an additional notation to address
values through a <em>delayed lines object</em> during the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> phase.</p>
<p>Let’s say that the interest in the logic is to compare the previous <em>close</em> value
to the actual value of a <em>simple moving average</em>. Rather than doing it manually
in each <code class="docutils literal notranslate"><span class="pre">next</span></code> iteration a pre-canned <em>lines</em> object can be generated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">movav</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovingAverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmpval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sma</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmpval</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Previous close is higher than the moving average&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here the <code class="docutils literal notranslate"><span class="pre">(delay)</span></code> notation is being used:</p>
<blockquote>
<div><ul>
<li><p class="first">This delivers a replica of the <code class="docutils literal notranslate"><span class="pre">close</span></code> prices but delayed by <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</p>
<p>And the comparison <code class="docutils literal notranslate"><span class="pre">self.data.close(-1)</span> <span class="pre">&gt;</span> <span class="pre">self.sma</span></code> generates another
<em>lines</em> object which returns either <code class="docutils literal notranslate"><span class="pre">1</span></code> if the condition is <code class="docutils literal notranslate"><span class="pre">True</span></code> or
<code class="docutils literal notranslate"><span class="pre">0</span></code> if <code class="docutils literal notranslate"><span class="pre">False</span></code></p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="lines-coupling">
<h2>Lines Coupling<a class="headerlink" href="#lines-coupling" title="Permalink to this headline">¶</a></h2>
<p>The operator <code class="docutils literal notranslate"><span class="pre">()</span></code> can be used as shown above with <code class="docutils literal notranslate"><span class="pre">delay</span></code> value to provide
a delayed version of a <em>lines</em> object.</p>
<p>If the syntax is used <em>WITHOUT</em> providing a <code class="docutils literal notranslate"><span class="pre">delay</span></code> value, then a
<code class="docutils literal notranslate"><span class="pre">LinesCoupler</span></code> <em>lines</em> object is returned. This is meant to establish a
coupling between indicators that operate on <em>datas</em> with different timeframes.</p>
<p>Data Feeds with different timeframes have different <em>lengths</em>, and the
indicators operating on them replicate the length of the data. Example:</p>
<blockquote>
<div><ul class="simple">
<li>A daily data feed has around 250 bars per year</li>
<li>A weekly data feed has 52 bars per year</li>
</ul>
</div></blockquote>
<p>Trying to create an operation (for example) which compares 2 <em>simple moving
averages</em>, each operating on the datas quoted above would break. It would be
unclear how to match the 250 bars from the daily timeframe to the 52 bars of
the weekly timeframe.</p>
<p>The reader could imagine a <code class="docutils literal notranslate"><span class="pre">date</span></code> comparison taking place in the background
to find out a day - week correspondence, but:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">Indicators</span></code> are just mathematical formulas and have no <em>datetime</em>
information</p>
<p>They know nothing about the environment, just that if the data provides
enough values, a calculation can take place.</p>
</li>
</ul>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">()</span></code> (empty call) notation comes to the rescue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># data0 is a daily data</span>
        <span class="n">sma0</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data0</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># 15 days sma</span>
        <span class="c1"># data1 is a weekly data</span>
        <span class="n">sma1</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># 5 weeks sma</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">buysig</span> <span class="o">=</span> <span class="n">sma0</span> <span class="o">&gt;</span> <span class="n">sma1</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buysig</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;daily sma is greater than weekly sma1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here the larger timeframe indicator, <code class="docutils literal notranslate"><span class="pre">sma1</span></code> is <em>coupled</em> to the daily
timeframe with <code class="docutils literal notranslate"><span class="pre">sma1()</span></code>. This returns an object which is compatible with the
larger numbers of bars of <code class="docutils literal notranslate"><span class="pre">sma0</span></code> and copies the values produced by <code class="docutils literal notranslate"><span class="pre">sma1</span></code>,
effectively spreading the 52 weekly bars in 250 daily bars</p>
</div>
<div class="section" id="operators-using-natural-constructs">
<h2>Operators, using natural constructs<a class="headerlink" href="#operators-using-natural-constructs" title="Permalink to this headline">¶</a></h2>
<p>In order to achieve the “ease of use” goal the platform allows (within the
constraints of Python) the use of operators. And to further enhance this goal
, the use of operators has been broken in two stages.</p>
<div class="section" id="stage-1-operators-create-objects">
<h3>Stage 1 - Operators Create Objects<a class="headerlink" href="#stage-1-operators-create-objects" title="Permalink to this headline">¶</a></h3>
<p>An example has already been seen even if not explicitly meant for this. During
the initialization phase (__init__ method) of objects like Indicators and
Strategies, operators create objects that can be operated upon, assigned or kept
as reference for later using during the evaluation phase of the Strategy’s
logic.</p>
<p>Once again a potential implementation of a SimpleMovingAverage, further broken
down into steps.</p>
<p>The code inside the SimpleMovingAverage indicator <cite>__init__</cite> could look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Sum N period values - datasum is now a *Lines* object</span>
    <span class="c1"># that when queried with the operator [] and index 0</span>
    <span class="c1"># returns the current sum</span>

    <span class="n">datasum</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SumN</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>

    <span class="c1"># datasum (being *Lines* object although single line) can be</span>
    <span class="c1"># naturally divided by an int/float as in this case. It could</span>
    <span class="c1"># actually be divided by anothr *Lines* object.</span>
    <span class="c1"># The operation returns an object assigned to &quot;av&quot; which again</span>
    <span class="c1"># returns the current average at the current instant in time</span>
    <span class="c1"># when queried with [0]</span>

    <span class="n">av</span> <span class="o">=</span> <span class="n">datasum</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">period</span>

    <span class="c1"># The av *Lines* object can be naturally assigned to the named</span>
    <span class="c1"># line this indicator delivers. Other objects using this</span>
    <span class="c1"># indicator will have direct access to the calculation</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">sma</span> <span class="o">=</span> <span class="n">av</span>
</pre></div>
</div>
<p>A more complete use case is shown during the initialization of a Strategy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sma</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovinAverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="n">close_over_sma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span> <span class="o">&gt;</span> <span class="n">sma</span>
        <span class="n">sma_dist_to_high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">high</span> <span class="o">-</span> <span class="n">sma</span>

        <span class="n">sma_dist_small</span> <span class="o">=</span> <span class="n">sma_dist_to_high</span> <span class="o">&lt;</span> <span class="mf">3.5</span>

        <span class="c1"># Unfortunately &quot;and&quot; cannot be overridden in Python being</span>
        <span class="c1"># a language construct and not an operator and thus a</span>
        <span class="c1"># function has to be provided by the platform to emulate it</span>

        <span class="n">sell_sig</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">close_over_sma</span><span class="p">,</span> <span class="n">sma_dist_small</span><span class="p">)</span>
</pre></div>
</div>
<p>After the above operations have taken place, <em>sell_sig</em> is a <em>Lines</em> object
which can be later used in the logic of the Strategy, indicating if the
conditions are met or not.</p>
</div>
<div class="section" id="stage-2-operators-true-to-nature">
<h3>Stage 2 - Operators true to nature<a class="headerlink" href="#stage-2-operators-true-to-nature" title="Permalink to this headline">¶</a></h3>
<p>Let’s first remember that a strategy has a <code class="docutils literal notranslate"><span class="pre">next</span></code> method which is called for
every bar the system processes. This is where operators are actually in the
stage 2 mode. Building on the previous example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sma</span> <span class="o">=</span> <span class="n">sma</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SimpleMovinAverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="n">close_over_sma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span> <span class="o">&gt;</span> <span class="n">sma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sma_dist_to_high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">high</span> <span class="o">-</span> <span class="n">sma</span>

        <span class="n">sma_dist_small</span> <span class="o">=</span> <span class="n">sma_dist_to_high</span> <span class="o">&lt;</span> <span class="mf">3.5</span>

        <span class="c1"># Unfortunately &quot;and&quot; cannot be overridden in Python being</span>
        <span class="c1"># a language construct and not an operator and thus a</span>
        <span class="c1"># function has to be provided by the platform to emulate it</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sell_sig</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">close_over_sma</span><span class="p">,</span> <span class="n">sma_dist_small</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Although this does not seem like an &quot;operator&quot; it actually is</span>
        <span class="c1"># in the sense that the object is being tested for a True/False</span>
        <span class="c1"># response</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sma</span> <span class="o">&gt;</span> <span class="mf">30.0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sma is greater than 30.0&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sma</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sma is above the close price&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sell_sig</span><span class="p">:</span>  <span class="c1"># if sell_sig == True: would also be valid</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sell sig is True&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sell sig is False&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sma_dist_to_high</span> <span class="o">&gt;</span> <span class="mf">5.0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;distance from sma to hig is greater than 5.0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Not a very useful strategy, just an example. During Stage 2 operators return the
expected values (boolean if testing for truth and floats if comparing them to
floats) and also arithmetic operations do.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Notice that comparisons are actually not using the [] operator. This
is meant to further simplify things.</p>
<p><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">self.sma</span> <span class="pre">&gt;</span> <span class="pre">30.0:</span></code> … compares <code class="docutils literal notranslate"><span class="pre">self.sma[0]</span></code> to <code class="docutils literal notranslate"><span class="pre">30.0</span></code> (1st
line and current value)</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">self.sma</span> <span class="pre">&gt;</span> <span class="pre">self.data.close:</span></code> … compares <code class="docutils literal notranslate"><span class="pre">self.sma[0]</span></code> to
<code class="docutils literal notranslate"><span class="pre">self.data.close[0]</span></code></p>
</div>
</div>
<div class="section" id="some-non-overriden-operators-functions">
<h3>Some non-overriden operators/functions<a class="headerlink" href="#some-non-overriden-operators-functions" title="Permalink to this headline">¶</a></h3>
<p>Python will not allow overriding everything and thus some functions are provided
to cope with the cases.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only meant to be used during Stage 1, to create objects which later
provide values.</p>
</div>
<p>Operators:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">and</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">And</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">or</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Or</span></code></li>
</ul>
</div></blockquote>
<p>Logic Control:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">if</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">If</span></code></li>
</ul>
</div></blockquote>
<p>Functions:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">any</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Any</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">all</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">All</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">cmp</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Cmp</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">max</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Max</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">min</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Min</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">sum</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Sum</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Sum</span></code> actually uses <code class="docutils literal notranslate"><span class="pre">math.fsum</span></code> as the underlying operation because the
platform works with floating point numbers and applying a regular <code class="docutils literal notranslate"><span class="pre">sum</span></code>
may have an impact on precision.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">reduce</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Reduce</span></code></p>
</li>
</ul>
</div></blockquote>
<p>These utility operators/functions operate on iterables. The elements in the
iterables can be regular Python numeric types (ints, floats, …) and also
objects with <em>Lines</em>.</p>
<p>An example generating a very dumb buy signal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sma1</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buysig</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">sma1</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">sma1</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buysig</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">pass</span>  <span class="c1"># do something here</span>
</pre></div>
</div>
<p>It is obvious that if the <code class="docutils literal notranslate"><span class="pre">sma1</span></code> is higher than the high, it must be higher
than the close. But the point is illustrating the use of <code class="docutils literal notranslate"><span class="pre">bt.And</span></code>.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">bt.If</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sma1</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">high_or_low</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">sma1</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
        <span class="n">sma2</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="n">high_or_low</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<p>Breakdown:</p>
<blockquote>
<div><ul>
<li><p class="first">Generate a <code class="docutils literal notranslate"><span class="pre">SMA</span></code> on <code class="docutils literal notranslate"><span class="pre">data.close</span></code> of <code class="docutils literal notranslate"><span class="pre">period=15</span></code></p>
</li>
<li><p class="first">And then</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">bt.If</span></code> the value of the <em>sma</em> is larger than <code class="docutils literal notranslate"><span class="pre">close</span></code>, return
<code class="docutils literal notranslate"><span class="pre">low</span></code>, else return <code class="docutils literal notranslate"><span class="pre">high</span></code></p>
<p>Remember that no actual value is being returned when <code class="docutils literal notranslate"><span class="pre">bt.If</span></code> is being
invoked. It returns a <em>Lines</em> object which is just like a
<em>SimpleMovingAverage</em>.</p>
<p>The values will be calculated later when the system runs</p>
</li>
</ul>
</li>
<li><p class="first">The generated <code class="docutils literal notranslate"><span class="pre">bt.If</span></code> <em>Lines</em> object is then fed to a 2nd <code class="docutils literal notranslate"><span class="pre">SMA</span></code> which
will sometimes use the <code class="docutils literal notranslate"><span class="pre">low</span></code> prices and sometimes the <code class="docutils literal notranslate"><span class="pre">high</span></code> prices for
the calculation</p>
</li>
</ul>
</div></blockquote>
<p>Those <strong>functions</strong> take also numeric values. The same example with a modification:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStrategy</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sma1</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">high_or_30</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">sma1</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
        <span class="n">sma2</span> <span class="o">=</span> <span class="n">btind</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="n">high_or_low</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<p>Now the 2nd moving average uses either <code class="docutils literal notranslate"><span class="pre">30.0</span></code> or the <code class="docutils literal notranslate"><span class="pre">high</span></code> prices to
perform the calculation, depending on the logic status of <code class="docutils literal notranslate"><span class="pre">sma</span></code> vs <code class="docutils literal notranslate"><span class="pre">close</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The value <code class="docutils literal notranslate"><span class="pre">30</span></code> is transformed internally into a pseudo-iterable which
always returns <code class="docutils literal notranslate"><span class="pre">30</span></code></p>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, 2016, 2017, 2018 Daniel Rodriguez.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>